<xml xmlns:py="http://genshi.edgewall.org/" py:strip=''>
<?python
  from collections import namedtuple
  from hashlib import md5

  def avatar_url(email, size=60):
    hash = md5(email.lower()).hexdigest()
    return 'http://www.gravatar.com/avatar/{}?size={}'.format(hash, size)

  User = namedtuple('User', 'id email amount name')

  users = [
    User(1, 'mig@ibofobi.dk', -42, 'sune'),
    User(2, 'f@doptio.com', -21, 'fritte'),
    User(3, 'car@csis.dk', +117, 'criis'),
    User(4, 'sbv@csis.dk', -54, 'vrist'),
  ]

  user = users[0]
?>
<py:def function='render_avatar_img(user, size=60)'>
  <img src='${avatar_url(user.email, size=size)}'
       class='avatar-img' width='${size}' height='${size}'
       alt="${user.name}'s avatar"/>
</py:def>
<py:def function='render_avatar(user, size=60)'>
  <span class='avatar' data-user='${user.id}'>
    ${render_avatar_img(user, size=size)}<br/>
    ${user.name}
  </span>
</py:def>

<py:def function='render_amount(amount)'>
  <span py:if='amount &lt; 0' class='red'>- ${'%.1f' % -amount}</span>
  <span py:if='amount >= 0' class='green'>+ ${'%.1f' % amount}</span>
</py:def>
</xml>
